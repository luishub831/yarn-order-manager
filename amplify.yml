version: 1
frontend:
  phases:
    preBuild:
      commands:
        # Install Node.js 22
        - nvm install 22
        - nvm use 22
        - nvm alias default 22
        - echo "Node version:" && node --version
        
        # Clean install
        - rm -rf node_modules package-lock.json .nuxt .output
        - npm install
        
    build:
      commands:
        - echo "Building application..."
        - ./node_modules/.bin/nuxt build
        
        # Check what was actually created
        - echo "Checking build outputs..."
        - ls -la
        - ls -la .amplify-hosting/ || echo "No .amplify-hosting directory"
        - ls -la .amplify-hosting/compute/ || echo "No compute directory"
        - ls -la .amplify-hosting/compute/default/ || echo "No default directory"
        - ls -la .amplify-hosting/static/ || echo "No static directory"
        - ls -la .output/ || echo "No .output directory"
        
  artifacts:
    baseDirectory: .amplify-hosting/static
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/*